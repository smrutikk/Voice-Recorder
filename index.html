<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voice Recorder</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        body {
            background: linear-gradient(90deg, #141e30, #243b55);
            color: white;
            text-align: center;
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }
        .wrapper {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.2);
            max-width: 500px;
            width: 90%;
        }
        .timer {
            font-size: 20px;
            font-weight: bold;
            color: #333;
        }
    </style>
</head>
<body>

    <div class="wrapper">
        <h2 class="text-dark">üéôÔ∏è Voice Recorder App</h2>

        <p class="timer" id="timer">00:00</p>
        <button id="recordBtn" class="btn btn-danger">Start Recording</button>
        <button id="playBtn" class="btn btn-primary" disabled>Play</button>
        <button id="saveBtn" class="btn btn-success" disabled>Save</button>
        <button id="downloadBtn" class="btn btn-warning" disabled>Download</button>

        <audio id="audioPlayer" class="mt-4 d-block mx-auto" controls></audio>

        <h4 class="text-dark mt-3">Saved Recordings</h4>
        <ul id="recordingList" class="list-group mx-auto mt-3" style="max-width: 500px;"></ul>
    </div>

    <script>
        let mediaRecorder, audioChunks = [];
        let audioBlob, audioUrl;
        let timerInterval, seconds = 0;
        let recordingName = "recording"; // Default name

        document.getElementById("recordBtn").addEventListener("click", async function () {
            if (!mediaRecorder || mediaRecorder.state === "inactive") {
                startRecording();
            } else {
                stopRecording();
            }
        });

        async function startRecording() {
            let stream = await navigator.mediaDevices.getUserMedia({ audio: true });
            mediaRecorder = new MediaRecorder(stream);
            audioChunks = [];

            mediaRecorder.ondataavailable = event => {
                audioChunks.push(event.data);
            };

            mediaRecorder.onstop = async () => {
                audioBlob = new Blob(audioChunks, { type: "audio/wav" });
                audioUrl = URL.createObjectURL(audioBlob);
                document.getElementById("audioPlayer").src = audioUrl;
                enableButtons();
                clearInterval(timerInterval);
                document.getElementById("timer").textContent = "00:00";
            };

            mediaRecorder.start();
            document.getElementById("recordBtn").textContent = "Stop Recording";

            // Start timer
            seconds = 0;
            timerInterval = setInterval(() => {
                seconds++;
                document.getElementById("timer").textContent = formatTime(seconds);
            }, 1000);
        }

        function stopRecording() {
            mediaRecorder.stop();
            document.getElementById("recordBtn").textContent = "Start Recording";
        }

        function enableButtons() {
            document.getElementById("playBtn").disabled = false;
            document.getElementById("saveBtn").disabled = false;
            document.getElementById("downloadBtn").disabled = false;
        }

        document.getElementById("playBtn").addEventListener("click", function () {
            document.getElementById("audioPlayer").play();
        });

        document.getElementById("saveBtn").addEventListener("click", async function () {
            if (audioBlob) {
                let newName = prompt("Enter a name for your recording:", "recording");
                if (newName) {
                    recordingName = newName;
                }

                const reader = new FileReader();
                reader.readAsDataURL(audioBlob);
                reader.onloadend = function () {
                    let savedRecordings = JSON.parse(localStorage.getItem("recordings") || "[]");
                    savedRecordings.push({ name: recordingName, data: reader.result });
                    localStorage.setItem("recordings", JSON.stringify(savedRecordings));
                    alert("Recording saved as " + recordingName);
                    loadRecordings();
                };
            }
        });

        document.getElementById("downloadBtn").addEventListener("click", function () {
            if (audioBlob) {
                let a = document.createElement("a");
                a.href = audioUrl;
                a.download = recordingName + ".mp3"; // Changed to .mp3
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
            }
        });

        function formatTime(seconds) {
            let min = Math.floor(seconds / 60);
            let sec = seconds % 60;
            return `${min.toString().padStart(2, '0')}:${sec.toString().padStart(2, '0')}`;
        }

        function loadRecordings() {
            let savedRecordings = JSON.parse(localStorage.getItem("recordings") || "[]");
            let list = document.getElementById("recordingList");
            list.innerHTML = "";

            savedRecordings.forEach((recording, index) => {
                let li = document.createElement("li");
                li.classList.add("list-group-item", "d-flex", "justify-content-between", "align-items-center");

                let audio = document.createElement("audio");
                audio.src = recording.data;
                audio.controls = true;

                let nameSpan = document.createElement("span");
                nameSpan.textContent = recording.name;
                nameSpan.style.fontWeight = "bold";

                let deleteBtn = document.createElement("button");
                deleteBtn.classList.add("btn", "btn-danger", "btn-sm");
                deleteBtn.textContent = "Delete";
                deleteBtn.onclick = function () {
                    savedRecordings.splice(index, 1);
                    localStorage.setItem("recordings", JSON.stringify(savedRecordings));
                    loadRecordings();
                };

                li.appendChild(nameSpan);
                li.appendChild(audio);
                li.appendChild(deleteBtn);
                list.appendChild(li);
            });
        }

        // Load saved recordings on page load
        loadRecordings();
    </script>

</body>
</html>
